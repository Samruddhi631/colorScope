<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ColorScope - Professional UI Color Palette Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .color-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .palette-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .notification-enter {
      animation: slideInRight 0.3s ease-out;
    }
    
    .notification-exit {
      animation: slideOutRight 0.3s ease-in;
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
  </style>
</head>
<body class="font-sans bg-gray-50 relative min-h-screen">

  <!-- Header Navigation -->
  <header class="bg-white">
    <nav class="flex justify-between shadow items-center px-6 py-4  mx-auto shadow ">
      <!-- Logo -->
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 gradient-bg rounded-lg flex items-center justify-center shadow-lg">
          <span class="text-white font-bold text-lg">C</span>
        </div>
        <div>
          <h1 class="font-bold text-xl text-gray-900">ColorScope</h1>
          <p class="text-xs text-gray-500">Professional UI Palette Generator</p>
        </div>
      </div>
      
      <!-- Navigation Actions -->
      <div class="flex items-center gap-6">
        <!-- Tools Dropdown -->
        <div class="relative">
          <button id="toolsBtn" class="text-pink-600 text-base font-medium flex hover:text-blue-600 transition-colors">
            Tools <i data-feather="chevron-down" class="w-4 h-4 mt-1.5"></i>
          </button>

          <!-- Dropdown Menu -->
          <div id="toolsDropdown"
            class="hidden absolute right-0 mt-2 w-165 h-120 bg-white flex gap-5 rounded-xl shadow-xl border border-gray-200 z-50">
            
            <div class="flex flex-col m-4">
              <!-- Left Column -->
              <div class=" rounded-xl hover:bg-green-100 flex cursor-pointer p-3 gap-4">
                <img src="./menu_icon_generate.svg" class="w-14 h-14" alt="">
                <div class="flex flex-col">
                    <h4 class="font-bold text-2xl text-gray-800 trackiing-tight">Palette Generator</h4>
                    <p class="text-gray-500 text-sm font-semibold">Create your palettes in seconds</p>
                </div>
              </div>
              <div class="rounded-xl hover:bg-pink-100 flex cursor-pointer p-3 gap-4">
                <img src="./menu_icon_explore.svg" class="w-14 h-14" alt="">
                <div class="flex flex-col">
                    <h4 class="font-bold text-2xl text-gray-800">Explore Palettes</h4>
                    <p class="text-gray-500 text-sm font-semibold">Browse millions of trending color schemes</p>
                </div>
              </div>
              <div class="rounded-xl hover:bg-yellow-100 flex cursor-pointer p-3 gap-4">
                <img src="./menu_icon_contrast_checker.svg" class="w-14 h-14" alt="">
                <div class="flex flex-col">
                    <h4 class="font-bold text-2xl text-gray-800">Image Picker</h4>
                    <p class="text-gray-500 text-sm font-semibold">Get beautiful palettes from your photos</p>
                </div>
              </div>
              <div class="rounded-xl hover:bg-blue-100 flex cursor-pointer p-3 gap-4">
                <img src="./menu_icon_image_picker.svg" class="w-14 h-14" alt="">
                <div class="flex flex-col">
                    <h4 class="font-bold text-2xl text-gray-800">Contrast Checker</h4>
                    <p class="text-gray-500 text-sm font-semibold">Check the contrast between two colors</p>
                </div>
              </div>
              <div class="rounded-xl hover:bg-purple-100 flex cursor-pointer p-3 gap-4">
                <img src="./menu_icon_visualizer.svg" class="w-14 h-14" alt="">
                <div class="flex flex-col">
                    <h4 class="font-bold text-2xl text-gray-800">Palette Visualizer</h4>
                    <p class="text-gray-500 text-sm font-semibold">Preview your colors on real designs</p>
                </div>
              </div>
            </div>
            <!-- Right Column (Links) -->
              <div class="px-10 py-10 text-base text-black flex flex-col bg-gray-100 rounded-r-xl">
                <span class="hover:text-blue-600 cursor-pointer font-medium">List of colors</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Browse Gradients</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Create a Gradient</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Make a Gradient Palette</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Color Picker</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Collage Maker</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">List of Fonts</span>
                <span class="hover:text-blue-600 cursor-pointer font-medium">Image Converter</span>
              </div>
          </div>
        </div>
        
        <div class="relative">
          <button id="paletteTypeBtn" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 color-transition">
            <span id="currentPaletteType">UI Design</span>
            <i data-feather="chevron-down" class="w-4 h-4"></i>
          </button>
          
          <!-- Palette Type Dropdown -->
          <div id="paletteTypeDropdown" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-200 z-50 py-2">
            <div class="palette-type-option px-4 py-3 hover:bg-blue-50 cursor-pointer" data-type="ui-design">
              <div class="font-medium text-gray-900">UI Design</div>
              <div class="text-sm text-gray-500">Perfect for web and mobile interfaces</div>
            </div>
            <div class="palette-type-option px-4 py-3 hover:bg-purple-50 cursor-pointer" data-type="brand-identity">
              <div class="font-medium text-gray-900">Brand Identity</div>
              <div class="text-sm text-gray-500">Corporate and brand color schemes</div>
            </div>
            <div class="palette-type-option px-4 py-3 hover:bg-green-50 cursor-pointer" data-type="illustration">
              <div class="font-medium text-gray-900">Illustration</div>
              <div class="text-sm text-gray-500">Creative and artistic palettes</div>
            </div>
            <div class="palette-type-option px-4 py-3 hover:bg-yellow-50 cursor-pointer" data-type="accessibility">
              <div class="font-medium text-gray-900">Accessibility First</div>
              <div class="text-sm text-gray-500">WCAG compliant high contrast</div>
            </div>
          </div>
        </div>
        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 
        color-transition shadow-sm">Generate</button>
      </div>
    </nav>
    <!-- Control Panel -->
    <div class="bg-white  border border-gray-200 px-6 py-2 mb-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        
        <!-- Left Side - Instructions -->
        <div class="flex items-center gap-6">
          <div>
            <!-- <h2 class="text-lg font-semibold text-gray-900 mb-1">Generate Professional Color Palettes</h2> -->
            <p class="text-gray-600">Press <kbd class="px-2 py-1 bg-gray-100 rounded text-xs font-mono">Space</kbd> or click Generate for new palettes</p>
          </div>
          <div id="paletteInfo" class="text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-lg font-medium"></div>
        </div>
        
        <!-- Right Side - Controls -->
        <div class="flex items-center gap-4 ">
          <!-- Color Count -->
          <div class="flex items-center gap-2">
            <span class="text-sm text-gray-600 font-medium">Colors:</span>
            <button id="decreaseColors" class="w-8 h-8 rounded-lg border border-gray-300 hover:border-gray-400 hover:bg-gray-50 color-transition flex items-center justify-center">
              <i data-feather="minus" class="w-4 h-4"></i>
            </button>
            <span id="colorCount" class="w-8 text-center font-medium text-gray-900">5</span>
            <button id="increaseColors" class="w-8 h-8 rounded-lg border border-gray-300 hover:border-gray-400 hover:bg-gray-50 color-transition flex items-center justify-center">
              <i data-feather="plus" class="w-4 h-4"></i>
            </button>
          </div>
          
          <div class="w-px h-6 bg-gray-300"></div>
          
          <!-- History Controls -->
          <div class="flex items-center gap-2">
            <button id="undoBtn" class="w-8 h-8 rounded-lg border border-gray-300 hover:border-gray-400 hover:bg-gray-50 color-transition flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
              <i data-feather="arrow-left" class="w-4 h-4"></i>
            </button>
            <button id="redoBtn" class="w-8 h-8 rounded-lg border border-gray-300 hover:border-gray-400 hover:bg-gray-50 color-transition flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
              <i data-feather="arrow-right" class="w-4 h-4"></i>
            </button>
          </div>
          
          <div class="w-px h-6 bg-gray-300"></div>
          
          <!-- Actions -->
          <div class="flex items-center gap-2">
            <button id="saveBtn" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 color-transition">
              <i data-feather="heart" class="w-4 h-4 inline mr-1"></i>Save
            </button>
            <button id="exportBtn" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 color-transition">
              <i data-feather="download" class="w-4 h-4 inline mr-1"></i>Export
            </button>
            <button id="shareBtn" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 color-transition">
              <i data-feather="share-2" class="w-4 h-4 inline mr-1"></i>Share
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class=" mx-auto px-6 pb-6">
    
    

    <!-- Color Palette Display -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6">
      <div id="colorPalette" class="flex min-h-[400px] relative">
        <!-- Colors will be dynamically generated here -->
      </div>
    </div>

    <!-- Palette Analytics -->
    <div id="paletteAnalytics" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Palette Analysis</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center">
          <div class="text-2xl font-bold text-blue-600" id="contrastScore">-</div>
          <div class="text-sm text-gray-600 mt-1">Avg Contrast Ratio</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-green-600" id="accessibilityScore">-</div>
          <div class="text-sm text-gray-600 mt-1">WCAG AA Compliance</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-purple-600" id="harmonyScore">-</div>
          <div class="text-sm text-gray-600 mt-1">Color Harmony</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Notifications -->
  <div id="notifications" class="fixed top-4 right-4 space-y-2 z-50">
    <!-- Notifications will be dynamically added here -->
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900">Export Palette</h3>
        <button id="closeExportModal" class="text-gray-400 hover:text-gray-600">
          <i data-feather="x" class="w-6 h-6"></i>
        </button>
      </div>
      
      <div class="space-y-3">
        <button class="export-option w-full text-left p-3 rounded-lg border hover:bg-gray-50 color-transition" data-format="css">
          <div class="font-medium">CSS Variables</div>
          <div class="text-sm text-gray-500">:root CSS custom properties</div>
        </button>
        <button class="export-option w-full text-left p-3 rounded-lg border hover:bg-gray-50 color-transition" data-format="json">
          <div class="font-medium">JSON</div>
          <div class="text-sm text-gray-500">Structured data format</div>
        </button>
        <button class="export-option w-full text-left p-3 rounded-lg border hover:bg-gray-50 color-transition" data-format="adobe">
          <div class="font-medium">Adobe ASE</div>
          <div class="text-sm text-gray-500">Adobe Swatch Exchange</div>
        </button>
        <button class="export-option w-full text-left p-3 rounded-lg border hover:bg-gray-50 color-transition" data-format="url">
          <div class="font-medium">Shareable URL</div>
          <div class="text-sm text-gray-500">Copy direct link to palette</div>
        </button>
      </div>
    </div>
  </div>

<script>
// =============================================================================
// COLOR PALETTE GENERATOR - OPTIMIZED FOR UI/UX DESIGN
// =============================================================================

class ColorPaletteGenerator {
  constructor() {
    this.init();
  }

  // =============================================================================
  // INITIALIZATION
  // =============================================================================
  
  init() {
    this.state = {
      currentPalette: null,
      history: JSON.parse(localStorage.getItem('paletteHistory')) || [],
      historyIndex: parseInt(localStorage.getItem('paletteIndex')) || -1,
      colorCount: 5,
      paletteType: 'ui-design',
      isGenerating: false
    };

    this.bindEvents();
    this.initializeFeatherIcons();
    this.loadInitialPalette();
  }

  bindEvents() {
    // Core controls
    document.getElementById('undoBtn').addEventListener('click', () => this.undo());
    document.getElementById('redoBtn').addEventListener('click', () => this.redo());
    document.getElementById('decreaseColors').addEventListener('click', () => this.adjustColorCount(-1));
    document.getElementById('increaseColors').addEventListener('click', () => this.adjustColorCount(1));
    
    // Palette type selector
    // Tools dropdown (original functionality)
    document.getElementById('toolsBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      document.getElementById('toolsDropdown').classList.toggle('hidden');
    });

    // Palette type selector
    document.getElementById('paletteTypeBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      document.getElementById('paletteTypeDropdown').classList.toggle('hidden');
    });
    
    document.querySelectorAll('.palette-type-option').forEach(option => {
      option.addEventListener('click', () => {
        this.setPaletteType(option.dataset.type);
      });
    });

    // Export functionality
    document.getElementById('exportBtn').addEventListener('click', () => this.showExportModal());
    document.getElementById('closeExportModal').addEventListener('click', () => this.hideExportModal());
    
    document.querySelectorAll('.export-option').forEach(option => {
      option.addEventListener('click', () => {
        this.exportPalette(option.dataset.format);
      });
    });

    // Global keyboard shortcuts
    document.addEventListener('keydown', (e) => this.handleKeyboard(e));
    
    // Close dropdowns on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('#toolsBtn')) {
        document.getElementById('toolsDropdown').classList.add('hidden');
      }
      if (!e.target.closest('#paletteTypeBtn')) {
        document.getElementById('paletteTypeDropdown').classList.add('hidden');
      }
    });

    // Close dropdowns on ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.getElementById('toolsDropdown').classList.add('hidden');
        document.getElementById('paletteTypeDropdown').classList.add('hidden');
      }
    });
  }

  initializeFeatherIcons() {
    if (typeof feather !== 'undefined') {
      feather.replace();
    }
  }

  loadInitialPalette() {
    if (this.state.historyIndex >= 0 && this.state.history.length > 0) {
      this.renderPalette(this.state.history[this.state.historyIndex]);
    } else {
      this.generateNewPalette();
    }
    this.updateUI();
  }

  // =============================================================================
  // CORE COLOR THEORY & ALGORITHMS
  // =============================================================================

  // Enhanced color conversion with better precision
  hslToHex(h, s, l) {
    h = ((h % 360) + 360) % 360; // Normalize hue
    s = Math.max(0, Math.min(100, s)) / 100; // Clamp saturation
    l = Math.max(0, Math.min(100, l)) / 100; // Clamp lightness

    const k = n => (n + h / 30) % 12;
    const a = s * Math.min(l, 1 - l);
    const f = n =>
      Math.round(
        (l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)))) * 255
      );
    
    const r = f(0).toString(16).padStart(2, '0');
    const g = f(8).toString(16).padStart(2, '0');
    const b = f(4).toString(16).padStart(2, '0');
    
    return `#${r}${g}${b}`.toLowerCase();
  }

  hexToHsl(hex) {
    const r = parseInt(hex.slice(1, 3), 16) / 255;
    const g = parseInt(hex.slice(3, 5), 16) / 255;
    const b = parseInt(hex.slice(5, 7), 16) / 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
      h = s = 0;
    } else {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      
      switch (max) {
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
  }

  // Calculate color contrast ratio (WCAG standards)
  getContrastRatio(color1, color2) {
    const getLuminance = (hex) => {
      const rgb = [1, 3, 5].map(i => {
        let c = parseInt(hex.slice(i, i + 2), 16) / 255;
        return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2];
    };

    const lum1 = getLuminance(color1);
    const lum2 = getLuminance(color2);
    const brightest = Math.max(lum1, lum2);
    const darkest = Math.min(lum1, lum2);
    
    return (brightest + 0.05) / (darkest + 0.05);
  }

  // Get optimal text color for background
  getOptimalTextColor(backgroundColor, options = {}) {
    const { forceWhite, forceBlack, threshold = 4.5 } = options;
    
    if (forceWhite) return '#ffffff';
    if (forceBlack) return '#000000';

    const whiteContrast = this.getContrastRatio(backgroundColor, '#ffffff');
    const blackContrast = this.getContrastRatio(backgroundColor, '#000000');

    // Return color that meets WCAG AA threshold, prefer higher contrast
    if (whiteContrast >= threshold && blackContrast >= threshold) {
      return whiteContrast > blackContrast ? '#ffffff' : '#000000';
    } else if (whiteContrast >= threshold) {
      return '#ffffff';
    } else if (blackContrast >= threshold) {
      return '#000000';
    } else {
      // Fallback: choose higher contrast even if below threshold
      return whiteContrast > blackContrast ? '#ffffff' : '#000000';
    }
  }

  // =============================================================================
  // ADVANCED PALETTE GENERATION ALGORITHMS
  // =============================================================================

  generateUIDesignPalette(baseHue, count) {
    const colors = [];
    const harmonies = ['complementary', 'triadic', 'analogous', 'split-complementary'];
    const harmony = harmonies[Math.floor(Math.random() * harmonies.length)];

    switch (harmony) {
      case 'complementary':
        colors.push(this.hslToHex(baseHue, this.random(60, 80), this.random(45, 65))); // Primary
        colors.push(this.hslToHex((baseHue + 180) % 360, this.random(50, 70), this.random(50, 70))); // Complement
        break;
        
      case 'triadic':
        for (let i = 0; i < Math.min(3, count); i++) {
          const hue = (baseHue + i * 120) % 360;
          colors.push(this.hslToHex(hue, this.random(55, 75), this.random(45, 65)));
        }
        break;
        
      case 'analogous':
        for (let i = 0; i < count; i++) {
          const hue = (baseHue + i * 30 - 60) % 360;
          colors.push(this.hslToHex(hue, this.random(50, 80), this.random(40, 70)));
        }
        break;
        
      case 'split-complementary':
        colors.push(this.hslToHex(baseHue, this.random(60, 80), this.random(45, 65))); // Base
        colors.push(this.hslToHex((baseHue + 150) % 360, this.random(50, 70), this.random(50, 70)));
        colors.push(this.hslToHex((baseHue + 210) % 360, this.random(50, 70), this.random(50, 70)));
        break;
    }

    // Fill remaining colors with variations
    while (colors.length < count) {
      const baseColor = colors[Math.floor(Math.random() * colors.length)];
      const [h, s, l] = this.hexToHsl(baseColor);
      const newHue = (h + this.random(-30, 30)) % 360;
      const newSat = Math.max(20, Math.min(90, s + this.random(-20, 20)));
      const newLight = Math.max(25, Math.min(85, l + this.random(-25, 25)));
      colors.push(this.hslToHex(newHue, newSat, newLight));
    }

    return {
      colors: colors.slice(0, count),
      name: `${harmony.charAt(0).toUpperCase() + harmony.slice(1)} UI`,
      description: `Professional UI palette using ${harmony} harmony`,
      harmony,
      baseHue
    };
  }

  generateBrandIdentityPalette(baseHue, count) {
    const colors = [];
    
    // Primary brand color (more saturated and confident)
    colors.push(this.hslToHex(baseHue, this.random(70, 90), this.random(45, 55)));
    
    // Secondary color (complementary or near-complementary)
    const secondaryHue = (baseHue + this.random(150, 210)) % 360;
    colors.push(this.hslToHex(secondaryHue, this.random(60, 80), this.random(50, 60)));
    
    // Neutral colors for balance
    colors.push(this.hslToHex(baseHue, this.random(10, 30), this.random(20, 30))); // Dark
    colors.push(this.hslToHex(baseHue, this.random(5, 15), this.random(85, 95))); // Light
    
    // Accent color
    if (count > 4) {
      const accentHue = (baseHue + this.random(60, 120)) % 360;
      colors.push(this.hslToHex(accentHue, this.random(80, 95), this.random(55, 65)));
    }

    return {
      colors: colors.slice(0, count),
      name: 'Brand Identity',
      description: 'Professional brand color scheme with strong visual identity',
      harmony: 'brand',
      baseHue
    };
  }

  generateIllustrationPalette(baseHue, count) {
    const colors = [];
    const temperature = Math.random() > 0.5 ? 'warm' : 'cool';
    
    if (temperature === 'warm') {
      // Warm palette (reds, oranges, yellows)
      for (let i = 0; i < count; i++) {
        const hue = (baseHue + this.random(-60, 60)) % 360;
        const adjustedHue = hue < 30 || hue > 300 ? hue : 
                           (Math.random() > 0.5 ? hue + 180 : hue - 180);
        colors.push(this.hslToHex(adjustedHue, this.random(60, 95), this.random(35, 75)));
      }
    } else {
      // Cool palette (blues, greens, purples)
      for (let i = 0; i < count; i++) {
        const hue = (baseHue + this.random(-45, 45)) % 360;
        const adjustedHue = (hue > 60 && hue < 300) ? hue : hue + 180;
        colors.push(this.hslToHex(adjustedHue, this.random(50, 85), this.random(40, 80)));
      }
    }

    return {
      colors: colors.slice(0, count),
      name: `${temperature.charAt(0).toUpperCase() + temperature.slice(1)} Illustration`,
      description: `Creative ${temperature} palette perfect for illustrations and artwork`,
      harmony: temperature,
      baseHue
    };
  }

  generateAccessibilityPalette(baseHue, count) {
    const colors = [];
    
    // High contrast pairs that meet WCAG AAA standards
    const darkColors = [
      this.hslToHex(baseHue, 80, 20), // Very dark primary
      this.hslToHex((baseHue + 60) % 360, 75, 25), // Dark secondary
      this.hslToHex((baseHue + 180) % 360, 70, 22), // Dark complement
    ];
    
    const lightColors = [
      this.hslToHex(baseHue, 60, 85), // Light primary
      this.hslToHex((baseHue + 60) % 360, 55, 90), // Light secondary
      this.hslToHex((baseHue + 180) % 360, 50, 88), // Light complement
    ];

    // Ensure we have high contrast pairs
    for (let i = 0; i < Math.ceil(count / 2); i++) {
      if (i < darkColors.length) colors.push(darkColors[i]);
      if (colors.length < count && i < lightColors.length) colors.push(lightColors[i]);
    }

    return {
      colors: colors.slice(0, count),
      name: 'Accessibility First',
      description: 'WCAG AAA compliant high-contrast palette',
      harmony: 'accessibility',
      baseHue
    };
  }

  // =============================================================================
  // PALETTE GENERATION CONTROLLER
  // =============================================================================

  generateNewPalette(forceHarmony = null, forceBaseHue = null) {
    if (this.state.isGenerating) return;
    
    this.state.isGenerating = true;
    const baseHue = forceBaseHue !== null ? forceBaseHue : Math.floor(Math.random() * 360);
    
    let palette;
    
    switch (this.state.paletteType) {
      case 'ui-design':
        palette = this.generateUIDesignPalette(baseHue, this.state.colorCount);
        break;
      case 'brand-identity':
        palette = this.generateBrandIdentityPalette(baseHue, this.state.colorCount);
        break;
      case 'illustration':
        palette = this.generateIllustrationPalette(baseHue, this.state.colorCount);
        break;
      case 'accessibility':
        palette = this.generateAccessibilityPalette(baseHue, this.state.colorCount);
        break;
      default:
        palette = this.generateUIDesignPalette(baseHue, this.state.colorCount);
    }

    // Add to history
    this.addToHistory(palette);
    this.renderPalette(palette);
    this.updateUI();
    
    setTimeout(() => {
      this.state.isGenerating = false;
    }, 100);
  }

  // =============================================================================
  // UI RENDERING
  // =============================================================================

  renderPalette(palette) {
    this.state.currentPalette = palette;
    const container = document.getElementById('colorPalette');
    container.innerHTML = '';

    palette.colors.forEach((color, index) => {
      const colorBox = this.createColorBox(color, index, palette.colors.length);
      container.appendChild(colorBox);
    });

    this.updatePaletteInfo(palette);
    this.analyzePalette(palette);
    this.initializeFeatherIcons();
  }

  createColorBox(color, index, totalColors) {
    const textColor = this.getOptimalTextColor(color);
    const [h, s, l] = this.hexToHsl(color);
    
    const box = document.createElement('div');
    box.className = 'flex-1 relative group cursor-pointer color-transition min-h-[400px] flex flex-col justify-center items-center p-6';
    box.style.backgroundColor = color;
    
    // Responsive text sizing based on color count
    let hexSize = 'text-2xl md:text-3xl lg:text-4xl';
    let detailSize = 'text-sm';
    let spacing = 'space-y-4';
    
    if (totalColors >= 7) {
      hexSize = 'text-lg md:text-xl lg:text-2xl';
      detailSize = 'text-xs';
      spacing = 'space-y-2';
    } else if (totalColors === 6) {
      hexSize = 'text-xl md:text-2xl lg:text-3xl';
      detailSize = 'text-sm';
      spacing = 'space-y-3';
    }

    box.innerHTML = `
      <div class="text-center ${spacing} opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        <div class="space-y-2">
          <h3 class="${hexSize} font-bold tracking-tight" style="color: ${textColor}">
            ${color.toUpperCase()}
          </h3>
          <div class="${detailSize} space-y-1" style="color: ${textColor}">
          </div>
        </div>
        
        <div class="flex justify-center gap-2 mt-4">
          <button class="copy-btn w-8 h-8 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 color-transition flex items-center justify-center" 
                  data-color="${color}" title="Copy HEX">
            <i data-feather="copy" class="w-4 h-4" style="stroke: ${textColor}"></i>
          </button>
        </div>
      </div>
      
      <!-- Always visible color info -->
      <div class="absolute bottom-4 left-4 right-4">
        <div class="text-center">
          <div class="${hexSize} font-bold" style="color: ${textColor}">
            ${color.toUpperCase().replace('#', '')}
          </div>
          <div class="${detailSize} opacity-80 mt-1" style="color: ${textColor}">
            Click to copy
          </div>
        </div>
      </div>
    `;

    // Add event listeners
    box.addEventListener('click', (e) => {
      if (!e.target.closest('.copy-btn') && !e.target.closest('.lock-btn')) {
        this.copyToClipboard(color);
      }
    });

    box.querySelector('.copy-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      this.copyToClipboard(color);
    });

    box.querySelector('.lock-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      this.toggleColorLock(index);
    });

    return box;
  }

  updatePaletteInfo(palette) {
    document.getElementById('paletteInfo').textContent = 
      `${palette.name} • ${palette.description}`;
  }

  analyzePalette(palette) {
    // Calculate average contrast ratio
    let totalContrast = 0;
    let contrastPairs = 0;
    let accessiblePairs = 0;

    for (let i = 0; i < palette.colors.length; i++) {
      for (let j = i + 1; j < palette.colors.length; j++) {
        const contrast = this.getContrastRatio(palette.colors[i], palette.colors[j]);
        totalContrast += contrast;
        contrastPairs++;
        if (contrast >= 4.5) accessiblePairs++;
      }
    }

    const avgContrast = contrastPairs > 0 ? (totalContrast / contrastPairs) : 0;
    const accessibilityScore = contrastPairs > 0 ? (accessiblePairs / contrastPairs * 100) : 0;

    document.getElementById('contrastScore').textContent = avgContrast.toFixed(1);
    document.getElementById('accessibilityScore').textContent = `${Math.round(accessibilityScore)}%`;
    document.getElementById('harmonyScore').textContent = this.getHarmonyScore(palette);
  }

  getHarmonyScore(palette) {
    // Simple harmony scoring based on hue relationships
    const hues = palette.colors.map(color => this.hexToHsl(color)[0]);
    let harmonyScore = 85; // Base score

    // Check for harmonic relationships
    const relationships = [];
    for (let i = 0; i < hues.length; i++) {
      for (let j = i + 1; j < hues.length; j++) {
        const diff = Math.abs(hues[i] - hues[j]);
        const minDiff = Math.min(diff, 360 - diff);
        relationships.push(minDiff);
      }
    }

    // Bonus for harmonic intervals (triadic, complementary, etc.)
    relationships.forEach(rel => {
      if (Math.abs(rel - 60) < 15 || Math.abs(rel - 120) < 15 || Math.abs(rel - 180) < 15) {
        harmonyScore += 5;
      }
    });

    return Math.min(100, Math.round(harmonyScore)) + '%';
  }

  // =============================================================================
  // USER INTERACTIONS
  // =============================================================================

  handleKeyboard(event) {
    if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
    
    switch (event.code) {
      case 'Space':
        event.preventDefault();
        this.generateNewPalette();
        break;
      case 'ArrowLeft':
        if (event.ctrlKey || event.metaKey) {
          event.preventDefault();
          this.undo();
        }
        break;
      case 'ArrowRight':
        if (event.ctrlKey || event.metaKey) {
          event.preventDefault();
          this.redo();
        }
        break;
      case 'KeyS':
        if (event.ctrlKey || event.metaKey) {
          event.preventDefault();
          this.savePalette();
        }
        break;
      case 'KeyE':
        if (event.ctrlKey || event.metaKey) {
          event.preventDefault();
          this.showExportModal();
        }
        break;
    }
  }

  copyToClipboard(color) {
    navigator.clipboard.writeText(color).then(() => {
      this.showNotification(`${color} copied to clipboard!`, 'success');
    }).catch(() => {
      this.showNotification('Failed to copy color', 'error');
    });
  }

  adjustColorCount(delta) {
    const newCount = Math.max(3, Math.min(8, this.state.colorCount + delta));
    if (newCount !== this.state.colorCount) {
      this.state.colorCount = newCount;
      if (this.state.currentPalette) {
        this.generateNewPalette(this.state.currentPalette.harmony, this.state.currentPalette.baseHue);
      }
      document.getElementById('colorCount').textContent = this.state.colorCount;
    }
  }

  setPaletteType(type) {
    this.state.paletteType = type;
    const typeNames = {
      'ui-design': 'UI Design',
      'brand-identity': 'Brand Identity', 
      'illustration': 'Illustration',
      'accessibility': 'Accessibility First'
    };
    
    document.getElementById('currentPaletteType').textContent = typeNames[type];
    document.getElementById('paletteTypeDropdown').classList.add('hidden');
    
    if (this.state.currentPalette) {
      this.generateNewPalette();
    }
  }

  toggleColorLock(index) {
    // TODO: Implement color locking functionality
    this.showNotification('Color locking coming soon!', 'info');
  }

  // =============================================================================
  // HISTORY MANAGEMENT
  // =============================================================================

  addToHistory(palette) {
    // Remove future history if we're not at the end
    this.state.history = this.state.history.slice(0, this.state.historyIndex + 1);
    
    // Add new palette
    this.state.history.push(palette);
    this.state.historyIndex = this.state.history.length - 1;
    
    // Limit history size
    if (this.state.history.length > 50) {
      this.state.history.shift();
      this.state.historyIndex--;
    }
    
    this.saveToLocalStorage();
  }

  undo() {
    if (this.state.historyIndex > 0) {
      this.state.historyIndex--;
      this.renderPalette(this.state.history[this.state.historyIndex]);
      this.updateUI();
      this.saveToLocalStorage();
    }
  }

  redo() {
    if (this.state.historyIndex < this.state.history.length - 1) {
      this.state.historyIndex++;
      this.renderPalette(this.state.history[this.state.historyIndex]);
      this.updateUI();
      this.saveToLocalStorage();
    }
  }

  saveToLocalStorage() {
    localStorage.setItem('paletteHistory', JSON.stringify(this.state.history));
    localStorage.setItem('paletteIndex', this.state.historyIndex.toString());
  }

  // =============================================================================
  // EXPORT FUNCTIONALITY
  // =============================================================================

  showExportModal() {
    document.getElementById('exportModal').classList.remove('hidden');
    document.getElementById('exportModal').classList.add('flex');
  }

  hideExportModal() {
    document.getElementById('exportModal').classList.add('hidden');
    document.getElementById('exportModal').classList.remove('flex');
  }

  exportPalette(format) {
    if (!this.state.currentPalette) return;
    
    const palette = this.state.currentPalette;
    let exportData;
    
    switch (format) {
      case 'css':
        exportData = this.generateCSSExport(palette);
        break;
      case 'json':
        exportData = this.generateJSONExport(palette);
        break;
      case 'adobe':
        exportData = this.generateAdobeExport(palette);
        break;
      case 'url':
        exportData = this.generateURLExport(palette);
        break;
    }
    
    if (format === 'url') {
      navigator.clipboard.writeText(exportData);
      this.showNotification('Shareable URL copied to clipboard!', 'success');
    } else {
      this.downloadFile(exportData.content, exportData.filename);
      this.showNotification(`${format.toUpperCase()} file downloaded!`, 'success');
    }
    
    this.hideExportModal();
  }

  generateCSSExport(palette) {
    const cssVars = palette.colors.map((color, index) => 
      `  --color-${index + 1}: ${color};`
    ).join('\n');
    
    const content = `:root {\n${cssVars}\n\n  /* Palette: ${palette.name} */\n  /* ${palette.description} */\n}`;
    
    return {
      content,
      filename: `palette-${palette.name.toLowerCase().replace(/\s+/g, '-')}.css`
    };
  }

  generateJSONExport(palette) {
    const content = JSON.stringify({
      name: palette.name,
      description: palette.description,
      colors: palette.colors,
      harmony: palette.harmony,
      baseHue: palette.baseHue,
      generatedAt: new Date().toISOString()
    }, null, 2);
    
    return {
      content,
      filename: `palette-${palette.name.toLowerCase().replace(/\s+/g, '-')}.json`
    };
  }

  generateAdobeExport(palette) {
    // Simplified ASE-like format (would need binary encoding for real ASE)
    const content = palette.colors.map((color, index) => {
      const [r, g, b] = [1, 3, 5].map(i => parseInt(color.slice(i, i + 2), 16));
      return `Color ${index + 1}: RGB(${r}, ${g}, ${b}) | HEX: ${color}`;
    }).join('\n');
    
    return {
      content: `Adobe Swatch Exchange (Simplified)\nPalette: ${palette.name}\n\n${content}`,
      filename: `palette-${palette.name.toLowerCase().replace(/\s+/g, '-')}.ase.txt`
    };
  }

  generateURLExport(palette) {
    const colorString = palette.colors.map(c => c.replace('#', '')).join('-');
    return `${window.location.origin}${window.location.pathname}?colors=${colorString}&name=${encodeURIComponent(palette.name)}`;
  }

  downloadFile(content, filename) {
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // =============================================================================
  // UI UPDATES & NOTIFICATIONS
  // =============================================================================

  updateUI() {
    const canUndo = this.state.historyIndex > 0;
    const canRedo = this.state.historyIndex < this.state.history.length - 1;
    
    document.getElementById('undoBtn').disabled = !canUndo;
    document.getElementById('redoBtn').disabled = !canRedo;
    
    if (canUndo) {
      document.getElementById('undoBtn').classList.remove('opacity-50', 'cursor-not-allowed');
    } else {
      document.getElementById('undoBtn').classList.add('opacity-50', 'cursor-not-allowed');
    }
    
    if (canRedo) {
      document.getElementById('redoBtn').classList.remove('opacity-50', 'cursor-not-allowed');
    } else {
      document.getElementById('redoBtn').classList.add('opacity-50', 'cursor-not-allowed');
    }
  }

  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    const colors = {
      success: 'bg-green-500',
      error: 'bg-red-500',
      info: 'bg-blue-500',
      warning: 'bg-yellow-500'
    };
    
    notification.className = `${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg notification-enter flex items-center gap-2`;
    notification.innerHTML = `
      <i data-feather="${type === 'success' ? 'check' : type === 'error' ? 'x' : 'info'}" class="w-4 h-4"></i>
      ${message}
    `;
    
    document.getElementById('notifications').appendChild(notification);
    
    // Re-initialize Feather icons for the notification
    if (typeof feather !== 'undefined') {
      feather.replace();
    }
    
    setTimeout(() => {
      notification.classList.remove('notification-enter');
      notification.classList.add('notification-exit');
      setTimeout(() => {
        notification.remove();
      }, 300);
    }, 3000);
  }

  // =============================================================================
  // UTILITY METHODS
  // =============================================================================

  random(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  savePalette() {
    if (!this.state.currentPalette) return;
    
    const saved = JSON.parse(localStorage.getItem('savedPalettes') || '[]');
    saved.push({
      ...this.state.currentPalette,
      savedAt: new Date().toISOString()
    });
    localStorage.setItem('savedPalettes', JSON.stringify(saved));
    this.showNotification('Palette saved successfully!', 'success');
  }
}

// =============================================================================
// INITIALIZE APPLICATION
// =============================================================================

document.addEventListener('DOMContentLoaded', () => {
  window.colorPaletteGenerator = new ColorPaletteGenerator();
  
  // Initialize Feather icons after DOM content is loaded
  if (typeof feather !== 'undefined') {
    feather.replace();
  }
});

</script>

</body>
</html>